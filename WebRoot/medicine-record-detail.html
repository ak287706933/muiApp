<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<meta name="Generator" content="">
	<meta name="Author" content="">
	<meta name="Keywords" content="">
	<meta name="Description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta content="telephone=no" name="format-detection">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" type="text/css" href="css/base.css">
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<!--  <link rel="stylesheet" type="text/css" href="css/font.css">
	<link rel="stylesheet" type="text/css" href="css/iconfont.css">-->
	<script type="text/javascript" src="js/jquery-2.1.3.min.js" ></script>
	<script type="text/javascript" src="js/layer_mobile/layer.js" ></script>
	<link rel="stylesheet" type="text/css" href="css/mui.picker.min.css"/>
	<link rel="stylesheet" href="css/mui.min.css">
	<script src="js/mui.min.js"></script>
	<script src="js/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
	<style type="text/css">
		.layui-m-layercont{padding:0}
	</style>
	<title>用药记录</title>
	<body>
		<!--header-->
		<div class="page_common_fixed">
			<header class="header_fixed">
				<a href="javascript:history.back(-1)" class="return_pre"></a>
				<div class="header_title">用药记录</div>
				<a onclick="updateDrug()" class="add_record add_finish">保存</a>
			</header>
		</div>
		<div class="header_fixed_div"></div>
		<!--header end-->
		<!--content-->
		<div class="content illness_list_content">
			<section class="illness_list add_medicine_record" >
				<div class="list_show_form">
					<div class="info_list">
						<div class="info_list_main">
							<span class="must_input">*</span>
							<a onclick="clickSearch()" class="modify_search">
								<div class="left">商品编码</div>
								<div class="right">
								<input type="hidden" id="wareidtag">
								<input type="text"  id="warecode1"  class="form_control" readonly="readonly"/></div>
							</a>
						</div>
					</div>
					<div class="info_list">
						<div class="info_list_main">
							<span class="must_input">*</span>
							<div class="left">药品名称</div>
							<div class="right"><input type="text"  class="form_control"  id="warename" readonly="readonly"/></div>
						</div>
					</div>
					<div class="info_list">
						<div class="info_list_main">
							<span class="must_input">*</span>
							<div class="left">生产企业</div>
							<div class="right"><input type="text"  class="form_control" id="factoryname" readonly="readonly"/></div>
						</div>
					</div>
					
					<div class="info_list">
						<div class="info_list_main">
							<span class="must_input">*</span>
							<div class="left">药物规格</div>
							<div class="right"><input type="text"  class="form_control"  id="warespec" readonly="readonly"/></div>
						</div>
					</div>
					
					<div class="info_list">
						<div class="info_list_main">
							<div class="left">用法用量</div>
							<div class="right"><input type="text"  class="form_control"  id="usage" /></div>
						</div>
					</div>
				</div>
			</section>
			<!--增加病史  section end-->
			<!--增加用药记录 section-->
			<section class="illness_list add_medicine_record" >
				<div class="list_show_form">
					<div class="info_list">
						<div class="info_list_main">
							<div class="left">可用天数</div>
							<div class="right"><input type="text"  class="form_control"  id="availabledays" /><span>天</span></div>
						</div>
					</div>
					<div class="info_list">
						<div class="info_list_main">
							<div class="left">使用状态</div>
							<div class="right" id="using_statue"><input type="text"  class="form_control"  id="stilluse"  readonly="readonly"/></div>
						</div>
					</div>
					<div class="info_list">
						<div class="info_list_main">
							<div class="left">开始时间</div>
							<div class="right" id="start_time">
								<input type="button" style="border: none" value="请选择" data-options='{}' id="datePicker1"/>
							</div>
						</div>
					</div>
					<div class="info_list">
						<div class="info_list_main">
							<div class="left">结束时间</div>
							<div class="right" id="end_time">
								<input type="button" style="border: none" value="请选择" data-options='{}' id="datePicker2"/>
							</div>
						</div>
					</div>
					
					 <script type="text/javascript">
									//记录日期选择
									(function($) {
										$.init();
										var pickBtn = document.querySelector("#datePicker1");
										pickBtn.addEventListener("tap",function(){
											var optionsJson = this.getAttribute('data-options') || '{}';
											var options = JSON.parse(optionsJson);
											var picker = new mui.DtPicker({
											　　　　"type":"date"
											　　　});
											picker.show(function(rs) {
												pickBtn.value = rs.text;
												picker.dispose();
											});
										},false);
										
										var pickBtn1 = document.querySelector("#datePicker2");
										pickBtn1.addEventListener("tap",function(){
											var optionsJson = this.getAttribute('data-options') || '{}';
											var options = JSON.parse(optionsJson);
											var picker = new mui.DtPicker({
											　　　　"type":"date"
											　　　});
											picker.show(function(rs) {
												pickBtn1.value = rs.text;
												picker.dispose();
											});
										},false);
										
									})(mui);
									
					 </script>
					
				</div>
			</section>
			<!--增加病史  section end-->
			<!--增加用药记录 section-->
			<section class="illness_list add_medicine_remark" >
				<div class="list_show_form">
					<div class="medicine_remark">
						<div class="remark_title">备注</div>
						<div class="microphone_input_box">
							<div class="microphone_label_section">
								<div class="microphone_input">
									<i class="icon_microphone"></i>
									<p>语音输入</p>
								</div>
							</div>
							<div class="input_textarea">
								<textarea class="reason_box" id="notes" placeholder="请输入" class="normal_gray"></textarea>
							</div>
						</div>
						</div>
					</div>
				</div>
			</section>
			<!--增加病史  section end-->
		</div>
		<!--content end-->
		<div class="microphone_section ">
			<!--开始说话前-->
			<div class="before_speak" >
				<div class="before_speak_box" >
					<p>按住说话</p>
					<a href="javascript:void(0)" class="iconfont hide_microphone"></a>
					<a href="javascript:void(0)" class="iconfont deal_microphone"></a>
				</div>
			</div>
			<!--开始说话前 end-->
			<!--说话中-->
			<div class="speaking" style="display: none;">
				<div class="speaking_box">
					<p>请说话</p>
					<div class="deal_shadow" >
						<a href="javascript:void(0)" class="iconfont deal_microphone"></a>
					</div>
				</div>
			</div>
			<!--说话中 end-->
			<!--说话完成后，待确认-->
			<div class="ensure_speak" style="display: none;">
				<div class="ensure_box">
					<div class="speaking_result">这里是语音转换成文字后的区域</div>
					<a href="javascript:void(0)" class="word_deal result_cancle">取消</a>
					<a href="javascript:void(0)" class="iconfont deal_microphone"></a>
					<a href="javascript：void(0)" class="word_deal result_ensure">确定</a>
				</div>
			</div>
			<!--说话完成后，待确认 end-->
		</div>
		<div class="microphone_section_kong"></div>
	</body>
	<script type="text/javascript">
		$(function(){
			//语音输入
			$('.microphone_input').on('touchstart',function(){
				$(".microphone_section").toggleClass('animate').siblings(".microphone_section_kong").toggle()
			});
			$('a.hide_microphone').click(function(){
				$(".microphone_section").removeClass('animate').sinlings('.microphone_section_kong').hide();
			});
			
			//使用状体选择
			$('#using_statue').click(function(){
				layer.open({
					shadeClose: true,
					'content':`<div class="status_options_box left_options select_section">
							   		<ul class="status_options_list select_options">
							   			<li val="0">使用中</li>
							   			<li val="1">已停用</li>
							   		</ul>
							   </div>`
				});
				$('ul.status_options_list li').click(function(){
					var $this = $(this);
					var val = $this.html() ;
					var statue = $this.attr('val');
					$this.addClass('on');
					$('#using_statue').html(val );
					setTimeout(function(){layer.closeAll()},800)
				})
			})
			
		})
		
		
	var memcardno;//会员卡号
	var compid;//企业编码
	var fileno;
	var warecode;
	var wareid;
	var warename;
	var warespec;
	var notes;
	var factoryname;
	var wareidtag;
	var type;
	//接收页面传过来的会员号
    function UrlSearch(){
       var name,value; 
       var str=location.href;
       var num=str.indexOf("?");
       str=str.substr(num+1);
       var arr=str.split("&");
       for(var i=0;i < arr.length;i++){ 
         num=arr[i].indexOf("="); 
          if(num>0){ 
          name=arr[i].substring(0,num);
          value=arr[i].substr(num+1);
          this[name]=value;
         } 
       } 
     } 
	
    var LocString=String(window.document.location.href);
    function GetQueryString(str){
    var rs=new RegExp("(^|)"+str+"=([^&]*)(&|$)","gi").exec(LocString),tmp;
    if(tmp=rs)return tmp[2];
    return " ";
    }
	
     var Request=new UrlSearch(); 
     memcardno=Request.memcardno;
     compid=Request.compid;
     fileno=Request.fileno;
     type=Request.type;
     //warecode=Request.warecode;
     
     wareid=decodeURI(GetQueryString("wareid"));
     warecode=decodeURI(GetQueryString("warecode"));
     warename=decodeURI(GetQueryString("warename"));
     warespec=decodeURI(GetQueryString("warespec"));
     notes=decodeURI(GetQueryString("notes"));
     factoryname=decodeURI(GetQueryString("factoryname"));
     wareidtag=decodeURI(GetQueryString("wareidtag"));
	 //用药信息明细
	 $.ajax({
		url:"getDrugDetails.do?memcardno="+memcardno+"&compid="+compid+"&fileno="+fileno+"&wareid="+wareid,
		type:"get",
		dataType:"json",
		success:function(data){
        var json = eval(data);
        var status;
        if(!isEmpty(data)){
        	$("#warecode1").val(json.WARECODE);
    		$("#warename").val(json.WARENAME);
    		$("#factoryname").val(json.FACTORYNAME);
    		$("#usage").val(json.NOTES);
    		$("#warespec").val(json.WARESPEC);
    		$("#availabledays").val(json.AVAILABLEDAYS);
    		//alert("=="+json.WAREID);
    		$("#wareidtag").val(json.WAREID);
    		//$("#datePicker1").val(json.STARTTIME);
    		//$("#datePicker2").val(json.ENDTIME);
    		if(json.STILLUSE==1){
    			status="使用中"
    		}else{
    			status="已停用"
    		}
    		$("#stilluse").val(status);
        }else{
           $("#warecode1").val(warecode);
 		   $("#warename").val(warename);
 		   $('#usage').val(notes);
 		   $('#warespec').val(warespec);
 		   $('#factoryname').val(factoryname);
        }
        
		},
		error:function(data){

		}
	 });
	 
	 function isEmpty(obj){
	     for (var name in obj){
	         return false;
	     }
	     return true;
	 };
     
     function updateDrug(){
		  // var usage=$('#usage').val();
		   var availabledays=$('#availabledays').val();
		   var stilluse=$("#stilluse").val();
		   var startTime=$("#datePicker1").val();
		   var endTime=$("#datePicker2").val();
		   var notes=$("#notes").val();
		   //var wareid=$("#wareidtag").val();
		   //alert("----"+wareid);
		   $.ajax({
				url:"updateDrug.do?compid="+compid+"&availabledays="+availabledays+"&stilluse="+stilluse+"&startTime="+startTime+"&endTime="+endTime+"&notes="+notes+"&wareid="+wareid+"&wareidtag="+wareidtag,
				type:"get",
				dataType:"json",
				success:function(data){
					location.href="member-relatives-info.html?memcardno="+memcardno+"&compid="+compid+"&fileno="+fileno+"&type="+type;
				}
	       });
     }
     
     function clickSearch(){
    	 location.href="medicine-searching-modify.html?memcardno="+memcardno+"&compid="+compid+"&fileno="+fileno+"&wareidtag="+wareid+"&type="+type;
     }
     
	</script>
</html>
